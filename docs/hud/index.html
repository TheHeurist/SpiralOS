<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŒ€ SpiralOS HUD â€” Epistemic Lattice</title>

<meta name="description" content="The SpiralOSÂ® Heads-Up Display (HUD): A living visualization of the Epistemic Lattice â€” where Conjugate Intelligence perceives its own holarchic structure.">
<link rel="icon" href="../seo/icon.png" type="image/png">

<!-- Open Graph Metadata -->
<meta property="og:title" content="SpiralOS HUD â€” Epistemic Lattice">
<meta property="og:description" content="Interactive visualization of the SpiralOS knowledge holarchy.">
<meta property="og:image" content="../seo/banner.png">
<meta property="og:type" content="website">
<meta property="og:url" content="https://theheurist.github.io/SpiralOS/docs/hud/">

<style>
  body {
    margin: 0;
    overflow: hidden;
    background-color: #000;
    font-family: "Segoe UI", Helvetica, Arial, sans-serif;
    color: #e4e4e4;
  }
  header {
    text-align: center;
    padding: 1em;
    background: rgba(0,0,0,0.75);
    border-bottom: 1px solid #333;
    position: fixed;
    width: 100%;
    top: 0;
    z-index: 10;
  }
  header h1 {
    margin: 0;
    font-size: 1.4em;
    color: #4ec8ff;
  }
  #hudCanvas {
    display: block;
    width: 100vw;
    height: 100vh;
  }
  footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    text-align: center;
    padding: 0.5em;
    font-size: 0.85em;
    background: rgba(0,0,0,0.6);
    color: #777;
    border-top: 1px solid #333;
  }
  #tooltip {
    position: absolute;
    color: #4ec8ff;
    font-family: monospace;
    font-size: 14px;
    pointer-events: none;
    padding: 4px 8px;
    border: 1px solid #4ec8ff;
    background: rgba(0,0,0,0.75);
    border-radius: 6px;
    display: none;
  }
</style>
</head>

<body>
<header>
  <h1>ðŸŒ€ SpiralOSÂ® HUD â€” Epistemic Lattice</h1>
</header>

<div id="tooltip"></div>
<canvas id="hudCanvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

<script type="module">
import {OrbitControls} from 'https://cdn.jsdelivr.net/npm/three@0.159.0/examples/jsm/controls/OrbitControls.js';

const canvas = document.getElementById("hudCanvas");
const tooltip = document.getElementById("tooltip");
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);

const controls = new OrbitControls(camera, renderer.domElement);
camera.position.set(0, 0, 6);
controls.update();

const colors = {
  "E*": 0xffcc00,
  "Âµ": 0x4ec8ff,
  "CI": 0xff77aa,
  "â„": 0x99ff88,
  "â„‹": 0xffaa44,
  "M": 0x8888ff,
  "Î¨": 0xff66ff,
  "C1": 0xbb99ff,
  "C2": 0xaa88ff,
  "C3": 0x9966ff
};

async function loadGraph() {
  const res = await fetch("../schema/schema-graph.yaml");
  const yamlText = await res.text();
  const graph = jsyaml.load(yamlText);
  renderGraph(graph);
}

function renderGraph(graph) {
  const group = new THREE.Group();
  const nodeMap = new Map();

  graph.nodes.forEach((n, i) => {
    const geometry = new THREE.SphereGeometry(0.12, 16, 16);
    const color = colors[n.id] || 0xffffff;
    const material = new THREE.MeshBasicMaterial({ color });
    const node = new THREE.Mesh(geometry, material);
    node.position.set(
      Math.sin(i) * 2.2,
      Math.cos(i * 1.2) * 2.2,
      Math.sin(i * 0.7) * 2.2
    );
    node.userData = n;
    group.add(node);
    nodeMap.set(n.id, node);
  });

  graph.relations.forEach(r => {
    const from = nodeMap.get(r.from), to = nodeMap.get(r.to);
    if (!from || !to) return;
    const points = new THREE.BufferGeometry().setFromPoints([from.position, to.position]);
    const line = new THREE.Line(
      points,
      new THREE.LineBasicMaterial({ color: 0x4444ff, opacity: 0.5, transparent: true })
    );
    group.add(line);
  });

  scene.add(group);

  // Hover logic
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  function onMouseMove(e) {
    mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(group.children.filter(c => c.isMesh));
    if (intersects.length > 0) {
      const data = intersects[0].object.userData;
      tooltip.style.display = "block";
      tooltip.style.left = e.clientX + 10 + "px";
      tooltip.style.top = e.clientY + 10 + "px";
      tooltip.innerHTML = `${data.id} â€” ${data.name}`;
      tooltip.onclick = () => window.open(`../${data.file}`, "_blank");
    } else tooltip.style.display = "none";
  }

  window.addEventListener("mousemove", onMouseMove);
  animate();
}

function animate() {
  requestAnimationFrame(animate);
  scene.rotation.y += 0.0015;
  renderer.render(scene, camera);
}

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

loadGraph();
</script>

<footer>
  SpiralOSÂ® â€” The Operating System of Knowing  
  <br><small>HUD Visualization Â© 2025 Carey G. Butler / Heurist GmbH</small>
</footer>
</body>
</html>
